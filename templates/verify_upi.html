<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Verify UPI PIN</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    /* ============ THEME TOKENS ============ */
    :root{
      --bg:        #f8fafc;
      --text:      #1e293b;
      --muted:     #64748b;
      --card:      #ffffff;
      --border:    #e2e8f0;

      --primary:   #2E8B57;  /* Eco green */
      --primary-2: #3CB371;  /* Mint green */
      --accent:    #3B82F6;  /* Blue */
      --warn:      #F59E0B;  /* Amber */
      --success:   #16a34a;

      --shadow:    0 12px 30px rgba(0,0,0,0.08);
      --shape-opacity: 0.12;
    }
    .dark-mode{
      --bg:        #0f172a;
      --text:      #cbd5e1;
      --muted:     #94a3b8;
      --card:      #1e293b;
      --border:    #475569;

      --primary:   #3CB371;
      --primary-2: #2E8B57;
      --accent:    #60a5fa;
      --warn:      #fbbf24;
      --success:   #22c55e;

      --shadow:    0 12px 30px rgba(0,0,0,0.45);
      --shape-opacity: 0.06;
    }

    /* ============ BASE ============ */
    *{ box-sizing:border-box; margin:0; padding:0; }
    body{
      background: var(--bg);
      color: var(--text);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      transition: background .3s, color .3s;
    }

    /* ============ FLOATING SHAPES ============ */
    .floating-shapes{ position:fixed; inset:0; z-index:-1; overflow:hidden; }
    .shape{ position:absolute; border-radius:50%; opacity:var(--shape-opacity); }
    .shape-1{ width:160px;height:160px;background:var(--primary); top:10%; left:-50px; animation:float 15s ease-in-out infinite; }
    .shape-2{ width:110px;height:110px;background:var(--accent); bottom:20%; right:-30px; animation:float 12s ease-in-out infinite 1s; }
    .shape-3{ width:90px; height:90px; background:var(--warn); top:55%; left:-20px; animation:float 18s ease-in-out infinite 2s; }
    @keyframes float{ 0%,100%{ transform:translateY(0) rotate(0) } 50%{ transform:translateY(-22px) rotate(12deg) } }

    /* ============ CARD ============ */
    .box{
      width: 420px; max-width: 92%;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 2.2rem 2rem;
      box-shadow: var(--shadow);
      animation: fadeInUp .7s ease both;
      position: relative;
      overflow:hidden;
    }
    .box::before{
      content:'';
      position:absolute; left:0; top:0; right:0; height:6px;
      background: linear-gradient(90deg, var(--primary), var(--accent), var(--warn), #8B5CF6);
    }
    @keyframes fadeInUp{ from{ opacity:0; transform:translateY(40px) } to{ opacity:1; transform:translateY(0) } }

    /* Header */
    h2{
      font-size: 1.9rem;
      margin-bottom:.75rem;
      background: linear-gradient(135deg, var(--primary), var(--primary-2));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .meta{
      color: var(--muted);
      margin-bottom: .25rem;
      font-size: .98rem;
    }
    .hint{
      color: var(--muted);
      margin: .4rem 0 1rem;
      font-size: .92rem;
    }

    /* ============ FORM ============ */
    .field{
      display:flex; align-items:center; justify-content:center;
      gap:.5rem; margin-top:.4rem;
    }
    input[type="password"]{
      width: 70%;
      text-align:center;
      padding: 12px;
      border: 2px solid var(--border);
      background: var(--card);
      color: var(--text);
      border-radius: 10px;
      font-size: 1.05rem;
      letter-spacing: .3em;
      transition: border .25s, box-shadow .25s, transform .08s;
    }
    input::placeholder{ color: var(--muted); letter-spacing: .1em; }
    input:focus{
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px color-mix(in srgb, var(--primary) 20%, transparent);
    }
    /* error + shake */
    .invalid{
      border-color: #ef4444 !important;
      box-shadow: 0 0 0 3px rgba(239,68,68,.18) !important;
      animation: shake .35s ease both;
    }
    @keyframes shake{
      10%,90%{ transform: translateX(-1px) }
      20%,80%{ transform: translateX(2px) }
      30%,50%,70%{ transform: translateX(-4px) }
      40%,60%{ transform: translateX(4px) }
    }

    /* ============ BUTTON ============ */
    .actions{ margin-top: 1rem; }
    button{
      width:100%;
      padding: 12px 16px;
      border:none;
      border-radius: 12px;
      color: #fff;
      font-weight: 700;
      letter-spacing: .2px;
      background: linear-gradient(135deg, var(--primary), var(--primary-2));
      box-shadow: 0 6px 14px color-mix(in srgb, var(--primary) 35%, transparent);
      cursor:pointer;
      transition: transform .2s, box-shadow .25s;
      position: relative; overflow:hidden;
    }
    button:hover{
      transform: translateY(-2px);
      box-shadow: 0 10px 22px color-mix(in srgb, var(--primary) 45%, transparent);
    }
    /* shimmer */
    button::after{
      content:''; position:absolute; inset:0;
      transform: translateX(-100%) skewX(-20deg);
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.35), transparent);
      transition: transform .6s ease;
    }
    button:hover::after{ transform: translateX(100%) skewX(-20deg); }

    /* ============ THEME TOGGLE ============ */
    .theme-toggle{
      position: fixed; top:20px; right:20px; z-index: 5;
      width:50px; height:50px; border:none; border-radius:50%;
      display:grid; place-items:center;
      background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
      box-shadow: 0 4px 15px rgba(0,0,0,.1);
      cursor:pointer; transition: transform .3s, box-shadow .3s, background .3s;
    }
    .theme-toggle:hover{ transform: rotate(15deg); box-shadow: 0 6px 20px rgba(0,0,0,.15); }
    .theme-toggle i{ font-size:1.2rem; color:#334155; transition: color .3s; }
    .dark-mode .theme-toggle{ background: linear-gradient(135deg, #475569, #334155); }
    .dark-mode .theme-toggle i{ color:#e2e8f0; }

    /* ============ SCROLLBAR ============ */
    ::-webkit-scrollbar{ width:8px }
    ::-webkit-scrollbar-track{ background:#e2e8f0; border-radius:10px }
    ::-webkit-scrollbar-thumb{ background: var(--primary); border-radius:10px }
    ::-webkit-scrollbar-thumb:hover{ background: var(--primary-2) }

    /* ============ RESPONSIVE ============ */
    @media (max-width: 460px){
      .box{ padding:1.6rem 1.1rem }
      input[type="password"]{ width: 100%; }
    }
    @media (prefers-reduced-motion: reduce){
      .shape, .box, button::after{ animation:none !important; transition:none !important; }
    }
  </style>
</head>
<body>
  <!-- Theme Toggle -->
  <button class="theme-toggle" id="theme-toggle" aria-label="Toggle dark mode">
    <i class="fas fa-moon"></i>
  </button>

  <!-- Floating Background -->
  <div class="floating-shapes" aria-hidden="true">
    <div class="shape shape-1"></div>
    <div class="shape shape-2"></div>
    <div class="shape shape-3"></div>
  </div>

  <!-- Card -->
  <div class="box" role="region" aria-labelledby="title">
    <h2 id="title">Verify UPI Payment</h2>
    <p class="meta">Product: <b>{{ product.title }}</b></p>
    <p class="meta">Total Amount: ₹{{ product.price }}</p>
    <p class="hint">Enter 6-digit UPI PIN (Hint: <code>872722</code>)</p>

    <form method="POST" action="{{ url_for('finalize_payment', product_id=product.id) }}" id="upi-pin-form" novalidate>
      <input type="hidden" name="payment_type" value="UPI">
      <div class="field">
        <input type="password" name="pin" id="pin" maxlength="6" pattern="[0-9]{6}" placeholder="••••••" inputmode="numeric" required>
      </div>
      <div class="actions">
        <button type="submit" id="submit-btn">Confirm Payment</button>
      </div>
    </form>
  </div>

  <script>
    // Theme: respect saved / OS preference and keep icons in sync
    const toggle = document.getElementById('theme-toggle');
    const icon = toggle.querySelector('i');
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)');
    const stored = localStorage.getItem('theme');

    function applyTheme(mode){
      const dark = mode === 'dark' || (!mode && prefersDark.matches);
      document.body.classList.toggle('dark-mode', dark);
      if(dark){ icon.classList.replace('fa-moon','fa-sun'); }
      else { icon.classList.replace('fa-sun','fa-moon'); }
    }
    applyTheme(stored);
    toggle.addEventListener('click', ()=>{
      const next = document.body.classList.contains('dark-mode') ? 'light' : 'dark';
      localStorage.setItem('theme', next);
      applyTheme(next);
    });

    // Simple client validation + shake on error
    const form = document.getElementById('upi-pin-form');
    const pin = document.getElementById('pin');
    form.addEventListener('submit', (e)=>{
      const ok = /^[0-9]{6}$/.test(pin.value.trim());
      if(!ok){
        e.preventDefault();
        pin.classList.add('invalid');
        pin.focus();
        setTimeout(()=> pin.classList.remove('invalid'), 450);
      }
    });
  </script>
</body>
</html>
